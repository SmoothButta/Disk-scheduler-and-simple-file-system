# Compiler
CXX = c++
CXXFLAGS = -Wall -Wextra -std=c++17 -Isrc

# Directories
SRC_DIR = src
OBJ_DIR = obj
BIN_DIR = bin
TEST_DIR = tests

# Executables
DISK_BIN = $(BIN_DIR)/disk_scheduler
FS_BIN = $(BIN_DIR)/file_system
DS_TEST = $(BIN_DIR)/test_diskscheduler
FS_TEST = $(BIN_DIR)/test_filesystem

# Source files
DISK_SRC = $(SRC_DIR)/DiskScheduler.cpp
FS_SRC = $(SRC_DIR)/FileSystem.cpp

# Object files
DISK_OBJ = $(OBJ_DIR)/DiskScheduler.o
FS_OBJ = $(OBJ_DIR)/FileSystem.o

# Test source files
DS_TEST_SRC = $(TEST_DIR)/test_diskscheduler.cpp
FS_TEST_SRC = $(TEST_DIR)/test_filesystem.cpp

# Default build target
all: setup $(DISK_BIN) $(FS_BIN)

# Ensure output directories exist
setup:
	mkdir -p $(OBJ_DIR) $(BIN_DIR)

# Build executables
$(DISK_BIN): $(DISK_OBJ)
	$(CXX) $(CXXFLAGS) $^ -o $@

$(FS_BIN): $(FS_OBJ)
	$(CXX) $(CXXFLAGS) $^ -o $@

# Compile source â†’ object
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp $(SRC_DIR)/%.h
	$(CXX) $(CXXFLAGS) -c $< -o $@

# ---------- TESTING ----------

tests: $(DS_TEST) $(FS_TEST)

$(DS_TEST): $(DISK_OBJ) $(DS_TEST_SRC)
	$(CXX) $(CXXFLAGS) $^ -o $@

$(FS_TEST): $(FS_OBJ) $(FS_TEST_SRC)
	$(CXX) $(CXXFLAGS) $^ -o $@

# Run unit tests
test: tests
	$(DS_TEST)
	$(FS_TEST)

# Clean all build files
clean:
	rm -rf $(OBJ_DIR) $(BIN_DIR)

.PHONY: all setup test tests clean



